<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Baraja fotográfica 3D – Cierre con clic fuera</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    :root{
      --w:clamp(170px, 44vw, 240px);
      --ratio:3/4;
      --gap:60%;
      --rotStep:6deg;
      --t:.45s cubic-bezier(.25,.8,.25,1);
      --zClosed:10;
      --zHover :20;
      --zOpen  :30;
    }
    *{margin:0;padding:0;box-sizing:border-box}
    body{
      min-height:100svh;display:grid;place-items:center;
      background:#eef1f7;font-family:system-ui,sans-serif;
      overflow-x:hidden;
    }
    .deck{
      position:relative;
      width:var(--w);
      height:calc(var(--w)/var(--ratio));
      perspective:1200px;
      touch-action:manipulation;
      margin-top: 30px;
    }
    .card{
      width:var(--w);aspect-ratio:var(--ratio);
      position:absolute;inset:0;
      border-radius:12px;overflow:hidden;cursor:pointer;
      transform-style:preserve-3d;
      box-shadow:0 4px 24px -8px rgba(0,0,0,.28);
      transition:transform var(--t),box-shadow var(--t);
      z-index:var(--zClosed);
      user-select: none;
    }
    .card img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      background: #eee;
      pointer-events: none;
      user-drag: none;
      -webkit-user-drag: none;
    }
    .card{
      transform:
        translateX(calc(var(--i)*var(--gap)))
        rotate(calc(var(--i)*var(--rotStep)));
    }
    @media (hover:hover){
      .deck:hover .card{
        transform:
          translateX(calc(var(--i)*var(--gap)*2.25))
          rotate(0deg);
      }
      .card:hover{
        transform:translateX(0) rotate(0deg) translateY(-14px) scale(1.08);
        z-index:var(--zHover);
        box-shadow:0 14px 32px -10px rgba(0,0,0,.45);
      }
    }
    .overlay{
      position:fixed;inset:0;
      background:rgba(0,0,0,.45);
      backdrop-filter:blur(2px);
      opacity:0;pointer-events:none;
      transition:opacity var(--t);
      z-index: 1000;
    }
    .overlay.show{opacity:1;pointer-events:auto}
    .modal-card {
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: fixed;
      inset: 0;
      z-index: 1001;
      background: none;
      pointer-events: none;
      transition: opacity .25s;
      opacity: 0;
    }
    .modal-card.abierto {
      display: flex;
      pointer-events: auto;
      opacity: 1;
    }
    #modalImg {
      max-width: min(90vw, 90vh*0.75);
      max-height: 90vh;
      border-radius: 16px;
      background: #222;
      box-shadow: 0 26px 52px -15px rgba(0,0,0,.55);
      transition: transform 0.4s cubic-bezier(.25,.8,.25,1), box-shadow 0.4s;
      transform: scale(0.98);
      object-fit: contain;
      touch-action:none;
    }
    .animar-modal {
      transform: scale(1.04);
    }
    #modalDesc {
      color: #fff;
      text-align: center;
      margin-top: 1rem;
      font-size: 1.1rem;
      text-shadow: 0 1px 4px #000c;
      max-width: 90vw;
      word-break: break-word;
    }
    @media (prefers-reduced-motion:reduce){
      .card,.modal-card,#modalImg{transition:none;animation:none}
    }
  </style>
</head>
<body>

<!-- Baraja de cartas -->
<div class="deck" id="deck">
  <div class="card" style="--i:-1;">
    <img src="img/Love.png" alt="Love, arte colorido.">
  </div>
  <div class="card" style="--i:0;">
    <img src="img/atardecer.jpg" alt="Atardecer en la playa.">
  </div>
  <div class="card" style="--i:1;">
    <img src="img/Noche_estrellada.jpg" alt="Noche estrellada al estilo Van Gogh.">
  </div>
  <div class="card" style="--i:2;">
    <img src="img/atardecer.jpg" alt="Atardecer de nuevo, paisaje cálido.">
  </div>
</div>

<!-- Overlay y Modal de imagen -->
<div id="modalOverlay" class="overlay"></div>
<div id="modalImagen" class="modal-card" aria-modal="true" role="dialog">
  <img id="modalImg" src="" alt="">
  <div id="modalDesc" class="desc"></div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Referencias al modal
    const modal          = document.getElementById('modalImagen');
    const modalImg       = document.getElementById('modalImg');
    const modalDesc      = document.getElementById('modalDesc');
    const modalOverlay   = document.getElementById('modalOverlay');
    const cards          = document.querySelectorAll('.card');
    const deck           = document.getElementById('deck');

    // Abrir modal al hacer click en una carta
    cards.forEach(card => {
      card.addEventListener('click', (e) => {
        e.stopPropagation();
        const img = card.querySelector('img');
        if (!img) return;
        const desc = img.alt || '';
        mostrarModal(img.src, desc);
      });
    });

    // Mostrar modal
    function mostrarModal(src, desc) {
      modalImg.src = src;
      modalImg.alt = desc;
      modalDesc.textContent = desc;
      modal.style.display = 'flex';
      modalImg.classList.remove('animar-modal');
      requestAnimationFrame(() => {
        modal.classList.add('abierto');
        setTimeout(() => {
          modalImg.classList.add('animar-modal');
        }, 10);
      });
      modalOverlay.classList.add('show');
      document.body.style.overflow = 'hidden';
    }

    // Cerrar modal
    function cerrarModal() {
      modal.classList.remove('abierto');
      modalImg.classList.remove('animar-modal');
      modalOverlay.classList.remove('show');
      document.body.style.overflow = '';
      setTimeout(() => {
        modal.style.display = 'none';
        modalImg.src = '';
        modalDesc.textContent = '';
      }, 200);
    }

    // Eventos para cerrar modal
    modalOverlay?.addEventListener('click', cerrarModal);
    window.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') cerrarModal();
    });

    // Cerrar modal deslizando la imagen hacia abajo (swipe down en móvil)
    let touchStartY = null;
    modalImg.addEventListener('touchstart', function(e) {
      if(e.touches.length === 1) {
        touchStartY = e.touches[0].clientY;
      }
    });
    modalImg.addEventListener('touchend', function(e) {
      if(touchStartY === null) return;
      const touchEndY = e.changedTouches[0].clientY;
      const dy = touchEndY - touchStartY;
      if(Math.abs(dy) > 60 && dy > 0) { // solo si desliza hacia abajo
        cerrarModal();
      }
      touchStartY = null;
    });

    // --- Cerrar modal o baraja al hacer clic en espacio blanco (NO en una carta o modal) ---
    document.body.addEventListener('click', function(e) {
      // Si el modal está abierto, cierra el modal si el click no fue en la imagen o la descripción
      if (modal.classList.contains('abierto')) {
        if (!modal.contains(e.target)) {
          cerrarModal();
        }
      }
    });

    // Previene que clicks dentro del modal no propaguen y disparen el cierre
    modal.addEventListener('click', function(e){
      e.stopPropagation();
    });

    // Si alguna vez quieres cerrar una carta “abierta” tipo laptop, aquí podrías hacer algo similar:
    // Ejemplo: document.body.addEventListener('click', function(e){ ... });

  });
</script>
</body>
</html>
